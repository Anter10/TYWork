{"version":3,"sources":["../../../../assets/Script/assets/Script/gamestart.js"],"names":["config","require","tywx","publicwx","curscene","gamestart","cc","Class","extends","Component","properties","startButton","default","type","Button","backButton","audioCtr","Prefab","gameScore","Label","historyLabel","phb","phbback","Sprite","helpback","giftback","method","phbSprite","shareBtn","Node","groupBtn","phbView","helpview","giftview","icon","_updateSubDomainCanvas","start","tex","Texture2D","showPhb","openDataContext","wx","getOpenDataContext","sharedCanvas","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","delayTime","msg","ShareInterface","getRandomOnShareAppMessageInfo","setOnShareAppMessageInfo","title","imageUrl","sharePointId","shareSchemeId","console","log","JSON","stringify","shareComponent","getComponent","setErrorCall","data","setSuccessCall","groupBtnComponent","self","setShareGroupCall","active","window","postMessage","MAIN_MENU_NUM","shareTicket","shareTickets","score","Util","getItemFromLocalStorage","string","length","node","x","tx","on","event","destroy","Math","abs","director","loadScene","loadFinishCallBack","IsWechatPlatform","shareAppMessage"],"mappings":"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","file":"gamestart.js","sourceRoot":"../../../../assets/Script","sourcesContent":["/*\n   游戏开始界面\n   created by gyc on 2018-08-02.\n   final changed time by gyc on  2018-08-03\n*/\nvar config = require(\"AddOneConfig\")\ntywx.publicwx = true;\n\nvar curscene = null;\nvar gamestart = cc.Class({\n    extends: cc.Component,\n    properties:{\n        startButton:{\n            default:null,\n            type: cc.Button,\n        },\n        backButton:{\n            default:null,\n            type: cc.Button,\n        },\n        audioCtr:{\n            default:null,\n            type: cc.Prefab,\n        },\n        gameScore:{\n            default: null,\n            type: cc.Label,\n        },\n        historyLabel:{\n            default: null,\n            type: cc.Label,\n        },\n        phb:{\n            default: null,\n            type: cc.Button,\n        },\n        phbback:{\n            default: null,\n            type:cc.Sprite,\n        },\n        helpback:{\n            default: null,\n            type:cc.Sprite,\n        },\n        giftback:{\n            default: null,\n            type:cc.Sprite,\n        },\n        method:{\n            default: null,\n            type: cc.Button,\n        },\n        phbSprite:{\n            default: null,\n            type:cc.Sprite,\n        },\n        shareBtn:{\n            default: null,\n            type:cc.Node,\n        },\n        groupBtn:{\n            default: null,\n            type:cc.Node,\n        },\n        phbView:{\n            default: null,\n            type:cc.Node,\n        },\n\n        helpview:{\n            default: null,\n            type:cc.Node,\n        },\n\n        giftview:{\n            default: null,\n            type:cc.Node,\n        },\n\n        \n        icon:cc.Sprite,\n       \n    },\n    _updateSubDomainCanvas () {\n        // let self = this;\n        // if (!self.tex) {\n        //     return;\n        // }\n        // openDataContext.postMessage({\n        //     method:1,\n\n        // });\n         \n    },\n    start () {\n        //是否发布微信版本\n        if(tywx.publicwx){\n            this.tex = new cc.Texture2D();\n            // window.sharedCanvas.width = 635;\n            // window.sharedCanvas.height = 796;\n        }\n        this.showPhb = false;\n    },\n\n    // 刷新子域的纹理\n    _updateSubDomainCanvas: function() {\n        if (!this.tex) {\n            return;\n        }\n        var openDataContext = wx.getOpenDataContext();\n        var sharedCanvas = openDataContext.canvas;\n        this.tex.initWithElement(sharedCanvas);\n        this.tex.handleLoadedTexture();\n        this.phbSprite.spriteFrame = new cc.SpriteFrame(this.tex);\n    },\n\n    /*\n        调用: 系统new 的时候调用。\n        功能: 该类的构造函数 可用于自身变量的初始化\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    ctor: function(){\n        \n    },\n\n    update: function(delayTime){\n        if(tywx.publicwx){\n           this._updateSubDomainCanvas();   \n        }\n    },\n\n    /*\n        调用: 界面加载完成后的回调。\n        功能: 该类的构造函数 可用于自身变量的初始化\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    onLoad:function(){\n       if(tywx.publicwx){\n            var msg = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n            if(msg){\n                tywx.ShareInterface.setOnShareAppMessageInfo(msg.title, msg.imageUrl, msg.sharePointId, msg.shareSchemeId);\n                console.log(\"当前获得的分享信息 = \"+JSON.stringify(msg))\n            }\n            // 设置分享组件的回调和数据\n            var shareComponent = this.shareBtn.getComponent(\"ShareButton\");\n            \n            if(shareComponent){\n                shareComponent.setErrorCall(function(data){\n                    console.log(\"分享失败后处理的回调函数 \",data);\n                })\n\n                shareComponent.setSuccessCall(function(data){\n                     console.log(\"分享成功后处理的回调函数 \",data);\n                })\n            }\n\n             // 设置群组排行榜组件的回调和数据\n             var groupBtnComponent = this.groupBtn.getComponent(\"ShareButton\");\n             var self = this;\n             if(groupBtnComponent){\n                groupBtnComponent.setShareGroupCall(function(data){\n                     if(self.showPhb){\n                        self.phbView.active = false;\n                        self.showPhb = false;\n                    }else{\n                        self.phbView.active = true;\n                        self.showPhb = true;\n                    }\n                     window.wx.postMessage({\n                            method: 2,\n                            MAIN_MENU_NUM: \"x1\",\n                            shareTicket: data.shareTickets[0]\n                     });\n\n                 })\n\n                 groupBtnComponent.setErrorCall(function(data){\n                    console.log(\"分享失败后处理的回调函数 \",data);\n                })\n  \n             }\n\n       }\n       var score = tywx.Util.getItemFromLocalStorage(\"maxscore\",0); \n       if(score != null){\n            this.gameScore.string = score;\n            let length = (score+\"\").length;\n            // 根据当前的分数来调整显示\n            if(length < 2){\n               this.historyLabel.node.x = this.historyLabel.node.x + 50;\n               this.gameScore.node.x    = this.gameScore.node.x + 50;\n            }else if(length > 5){\n               var tx = 25 + (length - 6) * 25;\n               this.historyLabel.node.x = this.historyLabel.node.x - tx;\n               this.gameScore.node.x    = this.gameScore.node.x - tx;\n            }\n        }else{\n            console.log(\"当前分数不存在\")\n        }\n        \n        // cc.loader.downloader.loadSubpackage(\"subone\",function(error){\n        //     if(error){\n        //         console.log(\"下载分包失败\");\n        //         return;\n        //     }\n        //     console.log(\"下载分包成功\");\n        // });\n        \n        \n        //   // 游戏的点击逻辑\n        this.phbback.node.on('touchstart', function ( event ) {\n           return true;\n        });\n        this.helpback.node.on('touchstart', function ( event ) {\n            return true;\n         });\n         this.giftback.node.on('touchstart', function ( event ) {\n            return true;\n         });\n        curscene = this;\n        // this.backButton.node.on(\"click\",this.returnView, this);\n       \n    },\n\n    /*\n        调用: 点击游戏帮助的时候调用\n        功能: 展示游戏玩法\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n\n     showPlayMethod:function(){\n         this.helpview.active = !this.helpview.active ? true : false;\n     },\n\n    /*\n        调用: 点击游戏帮助的时候调用\n        功能: 展示游戏玩法\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n\n    showGiftView:function(){\n        this.giftview.active = !this.giftview.active ? true : false;\n    },\n\n    /*\n        调用: 点击排行榜的时候调用\n        功能: 展示玩家微信好友在游戏中的排名\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    showFriendPhbView: function(){\n        console.log(\"Hellocd\")\n        if(this.showPhb){\n            this.phbView.active = false;\n            this.showPhb = false;\n        }else{\n            this.phbView.active = true;\n            this.showPhb = true;\n        }\n        if(tywx.publicwx){\n            console.log(\"Hellocd\")\n            wx.postMessage({\n                method: 1,\n                MAIN_MENU_NUM: \"x1\",\n            });\n            \n        }\n    },\n\n    /*\n        调用: 点击返回按钮\n        功能: 隐藏排行榜\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n   hidePhbView: function(){\n        console.log(\"çç.showPhb = \"+typeof(curscene.phbView))\n        if(curscene.showPhb){\n            curscene.phbView.active = false;\n            curscene.showPhb = false;\n        }else{\n            curscene.phbView.active = true;\n            curscene.showPhb = true;\n        }\n   },\n\n    /*\n        调用: 进入游戏的时候调用\n        功能: 清除当前界面占用的内存\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    loadFinishCallBack:function(){\n         if(this.node){\n            this.node.destroy();\n         }\n    },\n   \n     /*\n        调用: 进入小游戏的时候开始调用\n        功能: 显示玩家的最高得分\n        参数: [\n            score: 玩家当前的最高得分\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    setScore:function(score){\n        if(score != null){\n           this.gameScore.string = Math.abs(score);\n        }\n    },\n\n    /*\n        调用: 点击开始游戏的时候调用\n        功能: 进入游戏界面\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    startGame:function(){\n    \n       cc.director.loadScene(\"gamemain\", this.loadFinishCallBack);\n    },\n\n    /*\n\n    */\n    shareApp: function(){\n       if(tywx.IsWechatPlatform()){\n            wx.shareAppMessage({\n                title:\"赶紧加入我们，一起愉快的玩耍吧...\",\n                imageUrl:\"https://gss0.bdstatic.com/7Ls0a8Sm1A5BphGlnYG/sys/portrait/item/d68bced2b5c4b7dcb6b73838383d02.jpg?20180808115403\",\n            });\n       }\n    }\n\n});"]}