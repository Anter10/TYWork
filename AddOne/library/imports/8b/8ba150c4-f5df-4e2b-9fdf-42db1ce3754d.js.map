{"version":3,"sources":["../../../../assets/Script/assets/Script/gamestart.js"],"names":["config","require","gamestart","cc","Class","extends","Component","properties","startButton","default","type","Button","audioCtr","gameScore","Label","phb","method","phbSprite","Sprite","icon","_updateSubDomainCanvas","start","tywx","publicwx","tex","Texture2D","window","sharedCanvas","width","height","showPhb","openDataContext","wx","getOpenDataContext","canvas","initWithElement","handleLoadedTexture","spriteFrame","SpriteFrame","delayTime","postMessage","msg","ShareInterface","getRandomOnShareAppMessageInfo","setOnShareAppMessageInfo","title","imageUrl","sharePointId","shareSchemeId","console","log","JSON","stringify","score","Util","getItemFromLocalStorage","string","image","createImage","self","src","onload","event","texture","e","node","active","MAIN_MENU_NUM","destroy","Math","abs","director","loadScene","loadFinishCallBack","IsWechatPlatform","shareAppMessage"],"mappings":"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","file":"gamestart.js","sourceRoot":"../../../../assets/Script","sourcesContent":["/*\n   游戏开始界面\n   created by gyc on 2018-08-02.\n   final changed time by gyc on  2018-08-03\n*/\nvar config = require(\"AddOneConfig\")\n \nvar gamestart = cc.Class({\n    extends: cc.Component,\n    properties:{\n        startButton:{\n            default:null,\n            type: cc.Button,\n        },\n        audioCtr:{\n            default:null,\n            type: cc.Button,\n        },\n        gameScore:{\n            default: null,\n            type: cc.Label,\n        },\n        phb:{\n            default: null,\n            type: cc.Button,\n        },\n        method:{\n            default: null,\n            type: cc.Button,\n        },\n        phbSprite:{\n            default: null,\n            type:cc.Sprite,\n        },\n        icon:cc.Sprite,\n       \n    },\n    _updateSubDomainCanvas () {\n        // let self = this;\n        // if (!self.tex) {\n        //     return;\n        // }\n        // openDataContext.postMessage({\n        //     method:1,\n\n        // });\n         \n    },\n    start () {\n        //是否发布微信版本\n        tywx.publicwx = true;\n        if(tywx.publicwx){\n            this.tex = new cc.Texture2D();\n            window.sharedCanvas.width = 650;\n            window.sharedCanvas.height = 560;\n        }\n        this.showPhb = false;\n    },\n\n    // 刷新子域的纹理\n    _updateSubDomainCanvas: function() {\n        if (!this.tex) {\n            return;\n        }\n    \n        var openDataContext = wx.getOpenDataContext();\n        var sharedCanvas = openDataContext.canvas;\n        this.tex.initWithElement(sharedCanvas);\n        this.tex.handleLoadedTexture();\n        this.phbSprite.spriteFrame = new cc.SpriteFrame(this.tex);\n    },\n\n    /*\n        调用: 系统new 的时候调用。\n        功能: 该类的构造函数 可用于自身变量的初始化\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    ctor: function(){\n        \n    },\n\n    update: function(delayTime){\n        if(tywx.publicwx){\n           this._updateSubDomainCanvas();   \n        }\n       \n    },\n\n    /*\n        调用: 界面加载完成后的回调。\n        功能: 该类的构造函数 可用于自身变量的初始化\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    onLoad:function(){\n       if(tywx.publicwx){\n            window.wx.postMessage({\n                method: 3,\n            });\n            var msg = tywx.ShareInterface.getRandomOnShareAppMessageInfo();\n            if(msg){\n                tywx.ShareInterface.setOnShareAppMessageInfo(msg.title, msg.imageUrl, msg.sharePointId, msg.shareSchemeId);\n                console.log(\"当前获得的分享信息 = \"+JSON.stringify(msg))\n            }\n       }\n       var score = tywx.Util.getItemFromLocalStorage(\"maxscore\",0); \n       if(score){\n            console.log(\"score = \"+score)\n            this.gameScore.string = score;\n        }else{\n            console.log(\"当前分数不存在\")\n        }\n        \n       \n    },\n\n    /*\n        调用: 点击游戏帮助的时候调用\n        功能: 展示游戏玩法\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n\n    showPlayMethod:function(){\n        // tywx.AdManager.showAd(cc.p(333,160))\n        if(tywx.publicwx){\n            var image = wx.createImage();\n            var self = this\n            image.src = \"https://wx.qlogo.cn/mmopen/vi_32/U8XaLGeVibpjlibN0cJGiah2TTKarQdEI0QazibrrrsNibhMC2TrmscXQdfGEF4icW0B6A7TjjheTWpQiaD8wNhp3qZQQ/132\";\n            image.onload = (event) => {\n            try {\n                let texture = new cc.Texture2D();\n                texture.initWithElement(image);\n                texture.handleLoadedTexture();\n                self.icon.spriteFrame = new cc.SpriteFrame(texture);\n                // console.log(avatarUrl + \" ni/ \"+sprite.node.width + \" == \"+texture.width +\" \" + sprite.node.y)\n            } catch (e) {\n                cc.log(\"图片加载失败\");\n            }\n            };\n         }\n    },\n\n    /*\n        调用: 点击排行榜的时候调用\n        功能: 展示玩家微信好友在游戏中的排名\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    showPhbView: function(){\n        if(this.showPhb){\n            this.phbSprite.node.active = false;\n            this.showPhb = false;\n        }else{\n            this.phbSprite.node.active = true;\n            this.showPhb = true;\n        }\n        if(tywx.publicwx){\n            wx.postMessage({\n                method: 1,\n                MAIN_MENU_NUM: \"x1\",\n            });\n            \n        }\n    },\n\n    /*\n        调用: 进入游戏的时候调用\n        功能: 清除当前界面占用的内存\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    loadFinishCallBack:function(){\n         this.node.destroy();\n    },\n   \n     /*\n        调用: 进入小游戏的时候开始调用\n        功能: 显示玩家的最高得分\n        参数: [\n            score: 玩家当前的最高得分\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    setScore:function(score){\n        if(score != null){\n           this.gameScore.string = Math.abs(score);\n        }\n    },\n    /*\n        调用: 点击开始游戏的时候调用\n        功能: 进入游戏界面\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏需要\n    */\n    startGame:function(){\n       cc.director.loadScene(\"gamemain\", this.loadFinishCallBack);\n       \n    },\n\n    /*\n\n    */\n    shareApp: function(){\n       if(tywx.IsWechatPlatform()){\n            wx.shareAppMessage({\n                title:\"赶紧加入我们，一起愉快的玩耍吧...\",\n                imageUrl:\"https://gss0.bdstatic.com/7Ls0a8Sm1A5BphGlnYG/sys/portrait/item/d68bced2b5c4b7dcb6b73838383d02.jpg?20180808115403\",\n            });\n       }\n    }\n\n});"]}