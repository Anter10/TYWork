{"version":3,"sources":["../../../../assets/Script/assets/Script/gamemain.js"],"names":["config","require","gezi","mask","gamemain","cc","Class","extends","Component","properties","label","default","type","Label","num","GameOver","effect","Prefab","gameOut","Sprite","bg","Node","star","star1","restart","Button","score","point","maxphy_value","g_mask_samecnt","g_clickid","gamestate","gamestatetime","maxnum","lianjiNumber","g_gezi","g_mask","onLoad","string","i","geziNumber","node","addComponent","fontSize","lineHeight","color","position","p","parent","push","tmp_g","getAllgz","tmp_m","getAllmask","self","on","event","mpos","touch","getLocation","touchEndCallback","x","y","prerandomnumber","initgame","instantiate","addChild","ctor","gameState","waitclick","posx","gezi_size","posy","setnum","settoblock","block","effectid","effecttime","checkclick","update","dt","drawPhyPoint","length","tickmove","tickeffect","draw","getComponent","Graphics","resetAllMask","sc","checkmaskbyid","minCanRemoveNumber","domove","move_time","baseScore","step","speed_keep","gezi_pitch","actiontime_keep","id_keep","id_dest","from","adjustmove","gameOverCallBack","dealDoMove","dodrop","dealLianJiLogic","active","maxScoreShow","refreshbymask","bfound","j","dealLianJiNumber","lianjiEffects","sgood","cgood","hhgood","maxgood","ctx","clear","showphy_pros","colors","fillColor","swidth","phy_num","width","w","h","height","roundRect","radius","fill","visibleControllButton","vis","gameover","getrandomnum","needcheck","changenumbymask","reset","id","checkDirPaths","bj","add","Math","abs","tnum","parseInt","random","topid","tmpid","dis","adjustdrop","settoblockvalue","backFirstPage","tywx","Util","getItemFromLocalStorage","setItemToLocalStorage","publicwx","wx","postMessage","method","director","loadScene","destroyFinish","destroy"],"mappings":"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","file":"gamemain.js","sourceRoot":"../../../../assets/Script","sourcesContent":["/*\n    游戏的逻辑UI\n    游戏的操作的主要逻辑在这个module里面编写\n    created by gyc on 2018-08-01.\n*/\n\n// 倒入游戏涉及到的module\nvar config = require(\"AddOneConfig\")\nvar gezi   = require(\"GeZi\")\nvar mask   = require(\"GeZiMask\")\n\n\nvar gamemain = cc.Class({\n    extends: cc.Component,\n    properties: {\n        label: {\n            default: null,\n            type: cc.Label\n        },\n        num: {\n            default: [],\n            type: cc.Label\n        },\n        GameOver: {\n            default: null,\n            type: cc.Label\n        },\n        effect:{\n            default:null,\n            type: cc.Prefab,\n        },\n        gameOut:{\n            default:null,\n            type:cc.Sprite,\n        },\n       \n        // 游戏的背景\n        bg:cc.Node, \n        // 点击+1的动画sprite        \n        star:cc.Sprite, \n        // 组合+1的动画sprite    \n        star1:cc.Sprite,    \n        // 重新开始的按钮\n        restart:cc.Button,  \n        // 当前玩家得分\n        score: 0,\n        // 玩家当前体力 默认为最大值\n        point:config.maxphy_value,   \n        // 当前点击的块ID\n        g_mask_samecnt:0,\n        //点击的格子ID\n        g_clickid:-1,\n        //游戏状态-无，等待点击，移动，下落等\n        gamestate:'null', \n        //游戏状态的计时\n        gamestatetime:0,\n        //当前最大值\n        maxnum:5, \n        //此次点击产生的连击数\n        lianjiNumber:1, \n        // 存放每个格子的数组\n        g_gezi:[],\n        // 存放每个mask的数组\n        g_mask:[],\n    },\n\n    /*\n        调用: 场景加载完成后的回调\n        功能: 场景加载完成后的一些UI逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    onLoad: function () {\n        // 初始分数显示为0\n        this.label.string = this.score;\n        \n        // 循环生成初始游戏\n        for(var i=0;i<config.geziNumber;i++)\n        {\n            var node     = new cc.Node(\"node\");\n            var label    = node.addComponent(cc.Label);\n            label.string = \"\";\n            label.fontSize   = 64;\n            label.lineHeight = 64;\n            var color     = new cc.color(255,255,255,255);\n            node.position = cc.p(0,0);\n            node.color    = color;\n            node.parent   = this.node;\n            this.num.push(label);\n            var tmp_g = new gezi(i,this);\n            this.getAllgz().push(tmp_g);\n            var tmp_m = new mask(i, this);\n            this.getAllmask().push(tmp_m);\n        }\n        \n        var self = this;\n        // 游戏的点击逻辑\n        this.node.on('touchend', function ( event ) {\n            var mpos = event.touch.getLocation();\n            self.touchEndCallback(mpos.x,mpos.y);\n        });\n        // 前一个产生的随机数\n        this.prerandomnumber = 0;\n        // 初始游戏\n        this.initgame();\n       \n        var effect = cc.instantiate(this.effect);\n        this.node.parent.addChild(effect);\n        effect.x = 140;\n        effect.y = 90;\n       \n    },\n\n    /*\n        调用: 系统new 的时候调用。\n        功能: 该类的构造函数 可用于自身变量的初始化\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 系统自带\n    */\n    ctor:function(){\n       \n    },\n    \n    /*\n        调用: 在GeZi, GeZiData和该类中都有调用\n        功能: 得到当前的格子容器\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 方便统一管理\n    */\n    getAllgz :function(){\n        return this.g_gezi;\n    },\n    \n    /*\n        调用: 在GeZi, GeZiData和该类中都有调用\n        功能: 得到当前的mask容器\n        参数: [\n            无\n        ]\n        返回值: [\n            无\n        ]\n        思路: 方便统一管理\n    */\n    getAllmask: function(){\n        return this.g_mask;\n    },\n    \n     \n\n    /*\n        调用: 当点击屏幕的时候调用\n        功能: 处理点击屏幕产生的逻辑(主要是判断出当前点击的位置在某个格子上)\n        参数: [\n            x: 点击的X坐标\n            y: 点击点的Y坐标\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏和玩家的交互接口\n    */\n    touchEndCallback:function(x,y){\n        // 判断当前的游戏状态是否为等待点击状态\n        if(this.gamestate == config.gameState.waitclick){\n            for(var i = 0; i < config.geziNumber; i++){\n                // 根据点击的点 来判断当前点击在那个格子上面\n                if( x > this.getAllgz()[i].posx && x  < (this.getAllgz()[i].posx + config.gezi_size) &&\n                    y > this.getAllgz()[i].posy && y  < (this.getAllgz()[i].posy + config.gezi_size)){\n                    var  num = this.getAllgz()[i].num + 1;\n                    this.getAllgz()[i].setnum(num);\n                    this.getAllgz()[i].settoblock();\n                    this.getAllgz()[i].block.effectid   = 0;\n                    this.getAllgz()[i].block.effecttime = 0.5;\n                    if(num > this.maxnum){\n                       this.maxnum = num;\n                    }\n                    // 记录下当前点击的格子 和切换当前的游戏状态为检查点击状态\n                    this.g_clickid  = i;\n                    this.gamestate  = config.gameState.checkclick;\n                    // 终止此次点击的循环处理\n                    break;\n                }\n            }\n        }\n    },\n \n    /*\n        调用: 每一帧都调用\n        功能: 游戏的主体逻辑都在这个方法里面\n        参数: [\n            dt: 系统渲染的时间\n        ]\n        返回值:[\n            无\n        ]\n        思路: 每一帧都调用适合处理这个游戏的玩法和操作  \n    */\n    update: function (dt) {\n        this.label.string = this.score;\n        this.drawPhyPoint();\n        if(this.getAllgz().length == config.geziNumber) {\n            for (var i = 0; i < config.geziNumber; i++) {\n                this.getAllgz()[i].block.tickmove(dt);\n                this.getAllgz()[i].block.tickeffect(dt,this.star,this.star1);\n                this.getAllgz()[i].draw(this.bg.getComponent(cc.Graphics),this.num[i]);\n            }\n        }\n        switch (this.gamestate){\n            case config.gameState.checkclick:{ \n                this.resetAllMask();\n                var sc = this.getAllgz()[this.g_clickid].num;\n                this.lianjiNumber = 1;\n                this.checkmaskbyid(this.g_clickid, 0);\n                if (this.g_mask_samecnt >= config.minCanRemoveNumber) {\n                    this.gamestate = config.gameState.domove;\n                    this.gamestatetime = config.move_time;\n                    this.score += config.baseScore * (this.g_mask_samecnt - 1) * sc;\n                    for(var i = 0; i < config.geziNumber; i ++){\n                        // 判断是否已经标记 \n                        if(this.getAllmask()[i].step != 999 && this.getAllmask()[i].step != 0){\n                            this.getAllgz()[i].block.speed_keep = config.gezi_pitch * this.getAllmask()[i].step / config.move_time;\n                            this.getAllgz()[i].block.actiontime_keep = config.move_time / this.getAllmask()[i].step;\n                            this.getAllgz()[i].block.id_keep = i;\n                            this.getAllgz()[i].block.id_dest = this.getAllmask()[i].from;\n                            this.getAllgz()[i].block.adjustmove();\n                        }\n                    }\n                }else{\n                    this.gamestate = config.gameState.waitclick;\n                    this.point --;\n                    // 判断游戏是否结束\n                    if(this.point <= 0) {\n                       this.gameOverCallBack()\n                    }\n                }\n                break;\n            }\n            //格子组合移动，进入掉落状态\n            case config.gameState.domove:{\n                this.gamestatetime -= dt;\n                if(this.gamestatetime <= 0){\n                   this.dealDoMove()\n                }\n                break;\n            }\n            //格子掉落完，进入再次检查合并状态，或者等待点击状态\n            case config.gameState.dodrop:\n            {\n                this.gamestatetime -= dt;\n                if(this.gamestatetime <= 0){\n                   this.dealLianJiLogic();\n                }\n                break;\n            }\n        }\n    },\n    \n    /*\n        调用: 处于移动状态的时候调用\n        功能: 移动的逻辑处理\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏和玩家的交互的表现\n    */\n    dealDoMove(){\n         this.star.node.active = false;\n         this.gamestate        = config.gameState.dodrop;\n         this.gamestatetime    = config.move_time;\n         var num = this.getAllgz()[this.g_clickid].num + 1;\n         this.getAllgz()[this.g_clickid].setnum(num);\n         this.getAllgz()[this.g_clickid].settoblock();\n         this.getAllgz()[this.g_clickid].block.effectid = 1;\n         this.getAllgz()[this.g_clickid].block.effecttime = 0.5;\n         if(num > this.maxnum){\n             this.maxnum = num;\n             this.maxScoreShow();\n         }\n         this.refreshbymask();\n    },\n\n\n    /*\n        调用: 产生最大数字的时候调用\n        功能: 产生最大数字的逻辑处理\n        参数: [\n            无\n        ]\n        返回值: [\n            无\n        ]\n        思路: 逻辑需要\n    */\n    maxScoreShow: function(){\n\n    },\n   \n     /*\n        调用: 游戏处于掉落状态的时候调用\n        功能: 掉落状态的逻辑处理\n        参数: [\n            无\n        ]\n        返回值: [\n            无\n        ]\n        思路: 游戏和玩家的交互的表现\n    */\n    dealLianJiLogic: function(){\n        var bfound = false;\n        for(var j = 0; j < config.geziNumber; j++){\n            this.resetAllMask();\n            var sc =this.getAllgz()[j].num;\n            this.checkmaskbyid(j, 0);\n            if (this.g_mask_samecnt >= 3) {\n                this.gamestate = config.gameState.domove;\n                this.gamestatetime = config.move_time;\n                this.lianjiNumber ++;\n                this.score += config.baseScore * sc * (this.g_mask_samecnt - 1);\n                for(var i = 0; i < 25; i++){\n                    if(this.getAllmask()[i].step != 999 && this.getAllmask()[i].step != 0){\n                       this.getAllgz()[i].block.speed_keep = config.gezi_pitch * this.getAllmask()[i].step/config.move_time;\n                       this.getAllgz()[i].block.actiontime_keep = config.move_time / this.getAllmask()[i].step;\n                       this.getAllgz()[i].block.id_keep = i;\n                       this.getAllgz()[i].block.id_dest = this.getAllmask()[i].from;\n                       this.getAllgz()[i].block.adjustmove();\n                    }\n                } \n                bfound=true;\n                this.g_clickid = j;\n                if(this.point<5)\n                   this.point++;\n                   break;\n                }\n            }\n\n            if(bfound == false){\n               this.gamestate = config.gameState.waitclick;\n               // 判断连接数的大小 如果连接数大于不同的值则产生不同的效果\n               this.dealLianJiNumber();\n            }\n    },\n    \n    /*\n        调用: 当玩家点击一次交付结束后调用\n        功能: 展示相关的特效UI\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 多元化游戏元素\n    */\n    dealLianJiNumber: function(){\n           if(this.lianjiNumber > config.lianjiEffects.sgood && this.lianjiNumber < config.lianjiEffects.cgood ) {\n                 \n           }else if(this.lianjiNumber > config.lianjiEffects.cgood && this.lianjiNumber < config.lianjiEffects.hhgood ) {\n                 \n           }else if(this.lianjiNumber > config.lianjiEffects.hhgood && this.lianjiNumber < config.lianjiEffects.maxgood ) {\n                 \n           } \n    },\n\n\n    /*\n        调用: 1: 游戏初始的时候调用，2: 每次点击的时候没有连接的时候调用，3: 重新开始游戏的时候调用。\n        功能: 展示相关的特效UI\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏元素需求\n    */\n    drawPhyPoint:function(){\n        var ctx = this.bg.getComponent(cc.Graphics);\n        ctx.clear();\n        for(var i = 0;i< this.point; i++){\n            let color = config.showphy_pros.colors[i];\n            ctx.fillColor = cc.color(color[0],color[1],color[2]);\n            var x = (config.swidth - ((config.showphy_pros.phy_num - (config.maxphy_value - this.point)) * config.gezi_pitch)) / 2 + (config.showphy_pros.width + 10) * i;\n            var y = 980;\n            var w = config.showphy_pros.width;\n            var h = config.showphy_pros.height;\n            ctx.roundRect(x,y,w,h,config.showphy_pros.radius);\n            ctx.fill();\n        }\n    },\n    \n    /*\n        调用: 1: 游戏重新开始的时候需要隐藏，2: 游戏结束的时候需要显示\n        功能: gameOver和restart按钮的显示隐藏控制\n        参数: [\n            vis: false: 隐藏元素，true: 显示元素\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏逻辑需要\n    */\n    visibleControllButton:function(vis){\n        this.restart.node.active = vis;\n        this.GameOver.node.active = vis;\n        this.gameOut.node.active = vis;\n    },\n\n    /*\n        调用: 1: 游戏结束的时候需要显示\n        功能: 游戏结束的逻辑\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏逻辑需要\n    */\n    gameOverCallBack:function(){\n        this.gamestate = config.gameState.gameover;\n        this.visibleControllButton(true);\n    },\n\n\n    /*\n        调用: 1: 游戏开始的时候调用 2: 游戏重新开始的时候调用\n        功能: 游戏初始化\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏逻辑需要\n    */\n    initgame:function() {\n        this.score  = 0;\n        this.point  = config.maxphy_value;\n        this.maxnum = config.maxphy_value;\n \n        for (var i = 0; i < config.geziNumber; i++) {\n            var num = this.getrandomnum();\n            this.getAllgz()[i].setnum(num);\n            this.getAllgz()[i].settoblock();\n        }\n\n        var needcheck = true;\n\n        while(needcheck == true) {\n            needcheck = false;\n            for (var i = 0; i < config.geziNumber; i++) {\n                this.resetAllMask();\n                this.checkmaskbyid(i, 0);\n                if (this.g_mask_samecnt >= 3) {\n                    this.changenumbymask();\n                    needcheck = true;\n                }\n            }\n        }\n\n        this.gamestate = config.gameState.waitclick;\n        this.visibleControllButton(false)\n    },\n   \n    /*\n        调用: 1: 游戏处于检查点击的时候调用 2: 游戏开始的时候调用 3: 处理格子连接的时候调用\n        功能: 重置棋盘mask，为重新探路做准备\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏逻辑需要\n    */\n    resetAllMask:function(){\n        for(var i=0;i<config.geziNumber;i++){\n            this.getAllmask()[i].reset();\n        }\n        this.g_mask_samecnt = 1;\n    },\n    \n    \n     /*\n        调用: 1: 处理游戏点击的时候调用 2:游戏格子连接的时候调用\n        功能: 递归寻找给定ID的格子 并在mask数组里面进行标记\n        参数: [\n            无\n        ]\n        返回值:[\n            无\n        ]\n        思路: 游戏逻辑需要 通过mask标记来找出每次连接的格子\n    */\n    checkmaskbyid:function(id,step){\n        this.getAllmask()[id].step=step;\n        // 从左找\n        this.checkDirPaths(id, step,0, -1);\n        this.checkDirPaths(id, step,0, -5);\n        this.checkDirPaths(id, step,4, 1);\n        this.checkDirPaths(id, step,4, 5);\n    },\n    \n     /*\n        调用: 1: checkmaskbyid寻找可连的点\n        功能: 检查是否可以继续连接\n        参数: [\n            id: 每个格子的ID\n            step: 此次寻找的步数\n            bj: 寻找边界\n            add: 叠加数 上下加减5 左右加减1\n        ]\n        返回值:[\n           无\n        ]\n        思路: 根据递归寻找下一个点的连接情况\n    */\n    checkDirPaths: function(id, step, bj, add){\n        if(Math.abs(add) == 4 && this.getAllmask()[id] != null && this.getAllmask()[id].y == bj){\n           return false\n        }else if(Math.abs(add) == 1 && this.getAllmask()[id] != null && this.getAllmask()[id].x == bj){\n           return false\n        }\n        if(this.getAllmask()[id] == null || this.getAllmask()[id + add] == null){\n            return false;\n        }\n        if(this.getAllmask()[id + add].num != this.getAllmask()[id].num || this.getAllmask()[id + add].step <= step){\n           return false;\n        }\n\n        if(this.getAllmask()[id + add].step==999){\n            this.g_mask_samecnt++;\n        }\n\n        this.getAllmask()[id + add].step = step;\n        this.getAllmask()[id + add].from = id;\n        this.checkmaskbyid(id + add, step + 1, bj, add)\n    },\n\n\n     /*\n        调用: 游戏初始的时候调用\n        功能: 改变格子的数字 通过mask\n        参数: [\n           无\n        ]\n        返回值:[\n           无\n        ]\n        思路: 游戏逻辑需要\n    */\n    changenumbymask:function(){\n        for(var i = 0;i < config.geziNumber; i++){\n            if(this.getAllmask()[i].step != 999 && this.getAllmask()[i].step != 0){\n                var num = this.getrandomnum();\n                this.getAllgz()[i].setnum(num);\n                this.getAllgz()[i].settoblock();\n            }\n        }\n    },\n   \n   /*\n        调用: 1, 游戏初始的时候调用 2, 改变格子的数字的时候调用\n        功能: 创建随机的新块 返回新快的显示\n        参数: [\n           无\n        ]\n        返回值:[\n           num: 返回格子的显示数组\n        ]\n        思路: 游戏逻辑需要\n    */\n    getrandomnum:function(){\n        var tnum = this.maxnum - 2;\n        if(tnum<5)\n            tnum = 5;\n\n        var num = parseInt(Math.random() * 10000) % tnum + 1;\n        if(this.prerandomnumber == num){\n            return this.getrandomnum();\n        }else{\n            this.prerandomnumber = num;\n        }\n        return num;\n    },\n    \n    /*\n        调用: 游戏处于移动状态的时候调用\n        功能: 创建新的棋盘，为掉落做准备\n        参数: [\n           无\n        ]\n        返回值:[\n           无\n        ]\n        思路: 游戏逻辑需要\n    */\n    refreshbymask:function(){ \n        for(var i = 0;i < config.geziNumber;i++) {\n            if (this.getAllmask()[i].step != 999 && this.getAllmask()[i].step != 0) {\n                this.getAllmask()[i].from =- 1;\n                var topid = -1;\n                var tmpid = i + 5;\n                while(tmpid < config.geziNumber){\n                    if(this.getAllmask()[tmpid].step == 999 || this.getAllmask()[tmpid].step==0){\n                        topid = tmpid;\n                        break;\n                    }\n                    tmpid += 5;\n                }\n                if(topid != -1){\n                    var dis = this.getAllmask()[topid].y - this.getAllmask()[i].y;\n                    this.getAllgz()[i].block.posx        = this.getAllgz()[topid].posx;\n                    this.getAllgz()[i].block.posy        = this.getAllgz()[topid].posy;\n                    this.getAllgz()[i].block.id_keep     = topid;\n                    this.getAllgz()[i].block.id_dest     = i;\n                    this.getAllgz()[i].block.speed_keep  = (dis * config.gezi_pitch) / config.move_time;\n                    this.getAllgz()[i].block.adjustdrop();\n                    this.getAllgz()[topid].step = 888;\n                    var num = this.getrandomnum();\n                    // this.getAllgz()[i].setnum(this.getAllgz()[topid].num);\n                    this.getAllgz()[i].setnum(num);\n                    this.getAllgz()[i].settoblockvalue();\n                    this.getAllgz()[i].block.effectid       =  this.getAllgz()[topid].block.effectid;\n                    this.getAllgz()[i].block.effecttime     =  this.getAllgz()[topid].block.effecttime;\n                    this.getAllgz()[topid].block.effectid   =- 1;\n                    this.getAllgz()[topid].block.effecttime =  0;\n                }else{\n                    var dis = 5 - this.getAllmask()[i].y;\n                    this.getAllgz()[i].block.posx    = this.getAllgz()[i].posx;\n                    this.getAllgz()[i].block.posy    = this.getAllgz()[i].posy + dis * config.gezi_pitch;\n                    this.getAllgz()[i].block.id_keep = -1;\n                    this.getAllgz()[i].block.id_dest = i;\n                    this.getAllgz()[i].block.speed_keep = (dis * config.gezi_pitch) / config.move_time;\n                    this.getAllgz()[i].block.adjustdrop();\n                    var num = this.getrandomnum();\n                    this.getAllgz()[i].setnum(num);\n                    this.getAllgz()[i].settoblockvalue();\n                }\n            }\n        }\n    },\n    /*\n        调用: 点击返回首页的时候会调用\n        功能: 返回首页\n        参数: [\n           无\n        ]\n        返回值:[\n           无\n        ]\n        思路: 游戏逻辑需要\n    */\n    backFirstPage:function(){\n        if(tywx.Util.getItemFromLocalStorage(\"maxscore\", 0) < this.score){\n           tywx.Util.setItemToLocalStorage(\"maxscore\",this.score); \n        }\n        if(tywx.publicwx){\n            wx.postMessage({\n                method: 4,\n                score:this.score,\n            });\n        }\n        cc.director.loadScene(\"gamestart\", this.destroyFinish);\n    },\n\n    /*\n        调用: 点击返回首页的时候会调用\n        功能: 清除当前的节点\n        参数: [\n           无\n        ]\n        返回值:[\n           无\n        ]\n        思路: 游戏逻辑需要\n    */\n    destroyFinish:function(){\n        if(this.node){\n           this.node.destroy();\n        }\n    },\n});\n\n\n\n"]}