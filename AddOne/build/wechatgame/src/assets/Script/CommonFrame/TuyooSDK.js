console.log("TuyooSDK loaded"),tywx.TuyooSDK={SESSION_KEY:"TU_SESSION_STORAGE",login:function(){tywx.IsWechatPlatform()&&(tywx.TuyooSDK.getSystemInfo(),tywx.TuyooSDK.wechatLogin(),tywx.PropagateInterface._doHttpGetShareConfig())},wechatLogin:function(){try{if(!tywx.IsWechatPlatform())return;tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginStart,[]),wx.login({success:function(t){if(tywx.LOGD(null,"wx login success, params:"+JSON.stringify(t)),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginSuccess,[t.code]),t.code){var e=t.code;tywx.TuyooSDK.loginTuyooWithCode(e,{}),tywx.NotificationCenter.trigger(tywx.EventType.WEIXIN_LOGIN_SUCCESS)}},fail:function(t){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeWxLoginFailed,[]),tywx.LOGD(null,"wx login fail, params:"+JSON.stringify(t)),tywx.NotificationCenter.trigger(tywx.EventType.WEIXIN_LOGIN_FAIL)},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.wechatLogin\u2014\u2014"+JSON.stringify(t))}},loginTuyooWith3rdSession:function(){try{if(!tywx.IsWechatPlatform())return;wx.getStorage({key:tywx.TuyooSDK.SESSION_KEY,success:function(t){t.data?wx.request({url:tywx.SystemInfo.loginUrl+"open/v3/user/processSnsIdNew",data:{snsId:t.data,deviceName:"wechatGame",clientId:tywx.SystemInfo.clientId,appId:tywx.SystemInfo.appId},success:function(t){tywx.LOGD(null,"tuyoo login success, params:"+JSON.stringify(t))},fail:function(t){tywx.LOGD(null,"tuyoo login fail, params:"+JSON.stringify(t))},complete:function(t){}}):tywx.TuyooSDK.wechatLogin()},fail:function(t){tywx.TuyooSDK.wechatLogin()},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.loginTuyooWith3rdSession\u2014\u2014"+JSON.stringify(t))}},loginTuyooWithCode:function(t,e){try{if(!tywx.IsWechatPlatform())return;wx.showShareMenu({withShareTicket:!0});var o=e.gender||0,n=tywx.Util.getLocalUUID();tywx.LOGD("local_uuid:",n);var r=tywx.SystemInfo.loginUrl,i={appId:tywx.SystemInfo.appId,wxAppId:tywx.SystemInfo.wxAppId,clientId:tywx.SystemInfo.clientId,snsId:"wxapp:"+t,uuid:n,gender:o,scene_id:tywx.UserInfo.scene_id||"",scene_param:tywx.UserInfo.scene_param||"",invite_id:tywx.UserInfo.invite_id||0};e&&e.nickName&&(i.nickName=e.nickName),e&&e.avatarUrl&&(i.avatarUrl=e.avatarUrl),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKStart,[t,n,e.nickName]),wx.request({url:r+"open/v6/user/LoginBySnsIdNoVerify",header:{"content-type":"application/x-www-form-urlencoded"},data:i,method:"POST",success:function(o){tywx.LOGD(null,"tuyoo login success, params:"+JSON.stringify(o));var r=o.data;if(r.error&&1==r.error.code||!r.result||!r.result.userId)return console.log("tuyoo login fail..."),void setTimeout(tywx.TuyooSDK.login,200);var i=r.result;tywx.UserInfo.userId=i.userId,tywx.UserInfo.userName=i.userName,tywx.UserInfo.userPic=i.purl,tywx.UserInfo.authorCode=i.authorCode,tywx.UserInfo.wxgame_session_key=i.wxgame_session_key,tywx.LOGD(null,"userId:"+tywx.UserInfo.userId+" userName:"+tywx.UserInfo.userName+" userPic:"+tywx.UserInfo.userPic),tywx.UserInfo.userId&&tywx.UserInfo.userName?tywx.LOGE("TUYOO_SDK_LOGIN_SUCCESS",JSON.stringify(o)):tywx.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o));var c=i.token;tywx.LOGD(null,"token:"+c),wx.setStorage({key:tywx.TuyooSDK.SESSION_KEY,data:c}),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKSuccess,[t,n,e.nickName,i.userId]),tywx.showScene&&tywx.showQuery&&tywx.showQuery.sourceCode&&tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[tywx.showScene,tywx.showQuery.inviteCode,tywx.showQuery.sourceCode,tywx.showQuery.imageType,"GameStart"]),tywx.TuyooSDK.initWebSocketUrl(i),tywx.NotificationCenter.trigger(tywx.EventType.SDK_LOGIN_SUCCESS)},fail:function(o){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeLoginSDKFailed,[t,n,e.nickName]),tywx.LOGD(null,"tuyoo login fail, params:"+JSON.stringify(o)),tywx.LOGE("TUYOO_SDK_LOGIN_FAIL",JSON.stringify(o)),tywx.NotificationCenter.trigger(tywx.EventType.SDK_LOGIN_FAIL)},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.loginTuyooWithCode\u2014\u2014"+JSON.stringify(t))}},initWebSocketUrl:function(t){if(t&&t.tcpsrv){var e,o=t.tcpsrv.ip,n=t.tcpsrv.wsport||t.tcpsrv.port;e=tywx.SystemInfo.loginUrl.indexOf("https://")>-1?"wss://"+o+"/":"ws://"+o+":"+n.toString()+"/",tywx.LOGD(null,"webSocketUrl:"+e),tywx.SystemInfo.webSocketUrl=e}},getSystemInfo:function(){try{if(!tywx.IsWechatPlatform())return;wx.getSystemInfo({success:function(t){var e=t.model.indexOf("iPhone")>=0,o=t.windowHeight,n=0;n=e?812==o?2:736==o?4:1:3,tywx.UserInfo.systemType=n,tywx.UserInfo.wechatType=t.version,tywx.UserInfo.model=t.model,tywx.UserInfo.system=t.system,tywx.UserInfo.sdkVersion=t.SDKVersion,console.error("\u57fa\u7840\u5e93\u7248\u672c\u4e3a:"+tywx.UserInfo.sdkVersion),tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeSubmitVersionInfo,[t.version,t.SDKVersion,t.platform,t.system])},fail:function(){},complete:function(){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.getSystemInfo\u2014\u2014"+JSON.stringify(t))}},wechatAuthorize:function(){try{if(!tywx.IsWechatPlatform())return;wx.getSetting({success:function(t){t.authSetting["scope.userInfo"]?tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_SUCCESS):(tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationStart,[]),wx.authorize({scope:"scope.userInfo",success:function(){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationSuccess,[]),tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_SUCCESS)},fail:function(){tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeAuthorizationFailed,[]),tywx.NotificationCenter.trigger(tywx.EventType.START_AUTHORIZATION_FAILED)},complete:function(){}}))}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.wechatAuthorize\u2014\u2014"+JSON.stringify(t))}},createOrder:function(t,e,o,n){var r={};r.prodId=t,r.prodPrice=e,r.chargeType="wxapp.iap",r.gameId=tywx.SystemInfo.gameId,r.prodName=o,r.prodCount=n,r.appInfo={},tywx.TuyooSDK.rechargeOrder(r)},orderCallFunc:function(t,e,o){try{if(!tywx.IsWechatPlatform())return;var n=tywx.Util.getLocalUUID();wx.request({url:t,header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:tywx.UserInfo.userId,appId:tywx.SystemInfo.appId,wxAppId:tywx.SystemInfo.wxAppId,clientId:tywx.SystemInfo.clientId,imei:"null",uuid:n,platformOrderId:e},method:"POST",success:function(t){},fail:function(t){tywx.LOGE(null,"file = [Recharge] fun = [OrderCallFun] \u5145\u503c\u5931\u8d25 params = "+JSON.stringify(t))},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.orderCallFunc\u2014\u2014"+JSON.stringify(t))}},rechargeOrder:function(t){try{if(!tywx.IsWechatPlatform())return;var e=tywx.Util.getLocalUUID(),o=tywx.SystemInfo.loginUrl,n="hall37"==tywx.SystemInfo.hall_version?o+"open/v4/pay/order":o+"open/v5/pay/order";wx.request({url:n,header:{"content-type":"application/x-www-form-urlencoded"},data:{userId:tywx.UserInfo.userId,appId:tywx.SystemInfo.appId,wxAppId:tywx.SystemInfo.wxAppId,clientId:tywx.SystemInfo.clientId,imei:"null",uuid:e,prodId:t.prodId,prodName:t.prodName,prodCount:t.prodCount||1,prodPrice:t.prodPrice,chargeType:t.chargeType,gameId:t.gameId,appInfo:t.appInfo,mustcharge:t.mustcharge||1},method:"POST",success:function(t){tywx.LOGE(null,"tuyoo rechargeOrder success, params:"+JSON.stringify(t));var e=t.data.result;if(0==e.code){var o=e.chargeInfo,n=o.chargeData,r=n.notifyUrl,i=n.platformOrderId;tywx.LOGE(null,"tuyoo rechargeOrder success \u521b\u5efa\u8ba2\u5355\u6210\u529f, chargeData.mustcharge ="+n.mustcharge),n&&1==n.mustcharge?wx.requestMidasPayment({mode:n.mode,env:n.env,offerId:n.offerId,buyQuantity:10*o.chargeTotal,platform:n.platform,currencyType:"CNY",zoneId:n.zoneId,success:function(t){tywx.TuyooSDK.orderCallFunc(r,i,o.chargeCoin)},fail:function(e){tywx.LOGE(null,"\u7c73\u5927\u5e08\u652f\u4ed8 fail params = "+JSON.stringify(t)),e.errCode&&1==e.errCode&&tywx.TuyooSDK.cancelOrder(i)}}):n&&0==n.mustcharge&&tywx.TuyooSDK.orderCallFunc(r,i,o.chargeCoin)}else 1==e.code||e.code},fail:function(t){},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.rechargeOrder\u2014\u2014"+JSON.stringify(t))}},cancelOrder:function(t){try{var e=tywx.SystemInfo.loginUrl+"open/v4/pay/cancelorder",o={platformOrderId:t,appId:tywx.SystemInfo.appId,userId:tywx.UserInfo.userId,clientId:tywx.SystemInfo.clientId,payType:"wxapp.iap"};wx.request({url:e,header:{"content-type":"application/x-www-form-urlencoded"},data:o,method:"POST",success:function(t){tywx.LOGE(null,"tuyoo cancelOrder success, params:"+JSON.stringify(t))},fail:function(t){tywx.LOGE(null,"tuyoo cancelOrder fail, params:"+JSON.stringify(t))},complete:function(t){}})}catch(t){tywx.LOGE("error:","tywx.TuyooSDK.cancelOrder\u2014\u2014"+JSON.stringify(t))}}},tywx.WechatInterfaceInit=function(){try{if(tywx.IsWechatPlatform()){wx.onShow(function(t){tywx.LOGE("","+++++++++++++++++onShow+++++++++++++++++"+JSON.stringify(t));var e=t.scene,o=t.query,n="";tywx.showScene=e,tywx.showQuery=o,tywx.UserInfo.scene_id=e,tywx.UserInfo.scene_param=o.from||"",tywx.UserInfo.invite_id=o.inviteCode||0,tywx.StateInfo.isOnForeground=!0,tywx.NotificationCenter.trigger(tywx.EventType.GAME_SHOW,t);var r=tywx.Util.checkLocalUUID()?1:0;if(o&&o.gdt_vid&&o.weixinadinfo){var i="gdt."+o.weixinadinfo;tywx.UserInfo.scene_param=i,tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,i,r])}else o&&o.sourceCode?tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,o.inviteCode,o.sourceCode,o.imageType,"CardActive",r]):tywx.Util.isSceneQrCode(e)?(o.hasOwnProperty("scene")?n=o.scene:t.hasOwnProperty("path")&&(n=t.path),n.replace(".html",""),n=decodeURIComponent(n),tywx.UserInfo.scene_param=n,tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,n,r])):tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeUserFrom,[e,o.from,r]);tywx.TuyooSDK.login(),tywx.AdManager&&tywx.AdManager.onForeGround&&tywx.AdManager.onForeGround()}),wx.onHide(function(){tywx.LOGE("","+++++++++++++++++onHide+++++++++++++++++"),tywx.UserInfo.scene_id=0,tywx.StateInfo.isOnForeground=!1,tywx.NotificationCenter.trigger(tywx.EventType.GAME_HIDE),tywx.TCPClient.close()});var t=function(t){t.hasOwnProperty("isConnected")?tywx.StateInfo.networkConnected=t.isConnected:t.hasOwnProperty("errMsg")?tywx.StateInfo.networkConnected="getNetworkType:ok"==t.errMsg:tywx.StateInfo.networkConnected="none"!=t.networkType,tywx.StateInfo.networkType=t.networkType};wx.getNetworkType({success:t}),wx.onNetworkStatusChange(t),wx.onError(function(t){var e=new Date,o="userId:"+tywx.UserInfo.userId+"time:"+e.toDateString()+" "+e.toTimeString()+";"+t.message;tywx.BiLog.uploadLogTimely(o)})}}catch(t){tywx.LOGE("error:","tywx.WechatInterfaceInit\u2014\u2014"+JSON.stringify(t))}},tywx.WechatInterfaceInit();