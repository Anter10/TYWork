require=function c(i,r,s){function l(t,e){if(!r[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(u)return u(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var a=r[t]={exports:{}};i[t][0].call(a.exports,function(e){return l(i[t][1][e]||e)},a,a.exports,c,i,r,s)}return r[t].exports}for(var u="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({friendicon:[function(e,t,n){"use strict";cc._RF.push(t,"df1312uJO5DOpgdFArNGVZn","friendicon"),cc.Class({extends:cc.Component,properties:{friendmsd:cc.Node,nameLabel:cc.Label,scoreLabel:cc.Label,iconSprite:cc.Sprite},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],rankitem:[function(e,t,n){"use strict";cc._RF.push(t,"93486w69BJG5rxHNI3FISIF","rankitem");var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};cc.Class({extends:cc.Component,properties:{pmLabel:cc.Label,allPmicon:{default:[],type:cc.Sprite},imageIcon:cc.Sprite,nickLabel:cc.Label,scoreLabel:cc.Label},updateData:function(e){this.data=e,this.updateView(this.data)},updateView:function(e){console.log("更新数据 = "+JSON.stringify(e)),e.pm<3?(this.pmLabel.node.active=!1,this.allPmicon[e.pm].node.active=!0):this.pmLabel.string=e.pm+1,this.nickLabel.string=this.stringSlice(e.nickname,13),this.scoreLabel.string=null==e.KVDataList[0]?0:e.KVDataList[0].value+"分",this.createIcon(this.imageIcon,e.avatarUrl)},stringSlice:function(e,t){if(!e)return e;for(var n,o=0,a=0,c=0;c<e.length;c++){var i=e.charCodeAt(c);(a+=0<=i&&i<=128?1:2)<=t-2&&o++}return a<=t?n=e.slice(0):(n=e.slice(0,o),n+=".."),n},createIcon:function(t,e){var n=t;try{var o=wx.createImage();o.onload=function(){try{var e=new cc.Texture2D;e.initWithElement(o),e.handleLoadedTexture(),n.spriteFrame=new cc.SpriteFrame(e),console.log("加载失败___c1 "+(void 0===o?"undefined":a(o))+t._gycname)}catch(e){console.log("加载失败___v "+e),n.node.active=!1}},o.src=e}catch(e){console.log("加载失败____ddd "+e),n.node.active=!1}},start:function(){}}),cc._RF.pop()},{}],ranklist:[function(e,t,n){"use strict";cc._RF.push(t,"280c3rsZJJKnZ9RqbALVwtK","ranklist");var o="x1",h="",a=1,c=2,i=3,r=4,s=5;cc.Class({extends:cc.Component,properties:{gameranklist:cc.ScrollView,showloading:cc.Label,rankItem:cc.Prefab,gamerank:cc.Node,titleLabel:cc.Label,content:cc.Node,friendmsd:cc.Node,nameLabel:cc.Label,scoreLabel:cc.Label,iconSprite:cc.Sprite},start:function(){var t=this;wx.onMessage(function(e){t.showloading.node.active=!0,console.log("当前玩家给子域的数据 = "+JSON.stringify(e)),e.method==a?(t.titleLabel.string="  好友排行榜",t.getFriendData()):e.method==c?(t.titleLabel.string="群组排行榜",t.getGroupFriendData(e.shareTicket)):e.method==i?t.getUserInfoData():e.method==r?t.submitScore(e.score):e.method==s&&t.storeFriends(e.score)})},submitScore:function(t){var n=this;wx.getUserCloudStorage({keyList:[o],success:function(e){console.log("setUserCloudStorage","success",e),n.showloading.node.active=!1,0!=e.KVDataList.length&&e.KVDataList[0].value>t||window.wx.setUserCloudStorage({KVDataList:[{key:o,value:""+t}],success:function(e){console.log("setUserCloudStorage","success",e)},fail:function(e){console.log("setUserCloudStorage","fail")},complete:function(e){console.log("setUserCloudStorage","ok")}})},fail:function(e){console.log("getUserCloudStorage","fail")},complete:function(e){console.log("getUserCloudStorage","ok")}})},getUserInfoData:function(){wx.getUserInfo({openIdList:["selfOpenId"],lang:"zh_CN",success:function(e){console.log(JSON.stringify(e));wx.getSharedCanvas().getContext("2d")},fail:function(e){console.log(JSON.stringify(arguments));wx.getSharedCanvas().getContext("2d")}})},getFriendData:function(e,t){var g=this,f=t,m=this,p=e;wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){g.showloading.node.active=!1;var d=e.data[0];wx.getFriendCloudStorage({keyList:[o],success:function(e){var t=e.data;if(t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),null==p){m.gamerank.active=!0,m.friendmsd.active=!1,m.gameranklist.content.removeAllChildren();for(var n=20,o=0;o<t.length;o++){var a=t[o];0==(a.pm=o)&&(n=55);var c=cc.instantiate(g.rankItem);c.getComponent("rankitem").updateData(a),c.setPosition(0,-80*o-n),g.gameranklist.content.addChild(c,122)}if(t.length<=8)g.content.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE}else{m.gamerank.active=!1,m.friendmsd.active=!1;for(var i=null,r=t.length-1;0<=r;r--){var s=t[r],l=null==s.KVDataList[0]?0:s.KVDataList[0].value,u=l-f;if(h!=s.avatarUrl&&0<u&&u<=1e3&&d.avatarUrl!=s.avatarUrl){h=(i=s).avatarUrl,i.score=l;break}}i&&(m.friendmsd.active=!0,m.nameLabel.string=i.nickname,m.scoreLabel.string=i.score,m.createIcon(m.iconSprite,i.avatarUrl),console.log("刷新成功"))}},fail:function(e){console.log("wx.getFriendCloudStorage fail",e),m.showloading.string="数据加载失败，请检测网络，谢谢。"}})},fail:function(e){m.showloading.string="数据加载失败，请检测网络，谢谢。"}})},setDataToLocalStorage:function(e,t){try{console.log("wx setStorage = "+wx.setStorage),wx&&wx.setStorage&&(window.wx.setStorage({key:e,data:t+""}),console.log("存储数据成功"+t))}catch(e){console.log("存储数据失败","setItemToLocalStorage fail")}},storeFriends:function(e){this.getFriendData(!0,e)},getGroupFriendData:function(e){var i=this,r=this,t=e;r.friendmsd.active=!1,wx.getUserInfo({openIdList:["selfOpenId"],success:function(e){console.log("success",e.data);e.data[0];wx.getGroupCloudStorage({shareTicket:t,keyList:[o],success:function(e){console.log("群组数据 = ",e);var t=e.data;t.sort(function(e,t){return 0==e.KVDataList.length&&0==t.KVDataList.length?0:0==e.KVDataList.length?1:0==t.KVDataList.length?-1:t.KVDataList[0].value-e.KVDataList[0].value}),i.showloading.node.active=!1,r.gameranklist.content.removeAllChildren();for(var n=35,o=0;o<t.length;o++){var a=t[o];a.pm=o;var c=cc.instantiate(i.rankItem);c.getComponent("rankitem").updateData(a),0==o&&(n=55),c.setPosition(0,-80*o-n),i.gameranklist.content.addChild(c,122)}t.length<=8&&(i.content.getComponent(cc.Layout).resizeMode=cc.Layout.ResizeMode.NONE)},fail:function(e){console.log("得到群组数据失败",e)}})},fail:function(e){}})},onLoad:function(){console.log("Hvj")},createIcon:function(n,o){var a=n;try{var c=wx.createImage();c.src=o,c.onload=function(e){try{var t=new cc.Texture2D;t.initWithElement(c),t.handleLoadedTexture(),a.spriteFrame=new cc.SpriteFrame(t),console.log(o+" ni/ "+n.node.width+" == "+t.width+" "+n.node.y)}catch(e){cc.log("图片加载失败")}}}catch(e){}}}),cc._RF.pop()},{}]},{},["friendicon","rankitem","ranklist"]);