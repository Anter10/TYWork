{"version":3,"sources":["AdManager.js"],"names":["tywx","AdManager","retryTimes","AnimType","STATIC","SHAKE","FRAME","adNodeList","allAdInfoList","showAd","position","_adnode","adNodeClass","adInfoList","JSON","parse","stringify","createAdNode","push","getAdNodeList","getAdInfoList","adIconBtn","currentAdInfo","currentWebPage","adNodeObj","pos","genRandomFirstAdInfo","console","log","active","that","cc","loader","loadRes","err","prefab","preFabNode","instantiate","p","x","y","game","addPersistRootNode","adIconNode","adButton","getChildByName","on","onClickAdIconBtn","length","weight_list","i","_randomObj","parseInt","icon_weight","icon_id","sort","a","b","weight","_total","forEach","element","_randomIndex","Math","random","_tTotal","_selectIndex","_selectObj","id","genRandomSecondAdInfo","_webPages","webpages","webpage_weight","config_id","_animaType","icon_type","spriteIco","stopAllActions","removeComponent","Animation","setRotation","BiLog","clickStat","clickStatEventType","clickStatEventTypeShowAdBtn","icon_skip_type","toappid","togame","load","url","icon_url","texture","getComponent","Sprite","spriteFrame","SpriteFrame","width","height","setContentSize","size","error","anchorX","anchorY","_act1","rotateBy","_act2","_act3","_act4","_delay","delayTime","runAction","repeatForever","sequence","repeat","allFrames","playFrameAction","_firstFrameIcon","getTexture","animation","addComponent","clip","AnimationClip","createWithSpriteFrames","name","wrapMode","WrapMode","Loop","addClip","play","results","getError","getContent","_frame","skip_type","topath","path","second_toappid","clickStatEventTypeClickAdBtn","wx","navigateToMiniProgram","appId","envVersion","extraData","from","success","res","clickStatEventTypeClickDirectToMiniGameSuccess","webpage_url","fail","clickStatEventTypeClickDirectToMiniGameFail","complete","resetBtnIcon","clickStatEventTypeClickShowQRCode","IsWechatPlatform","previewImage","current","urls","LOGD","LOGE","onForeGround","showAdNode","hideAdNode","requestADInfo","reqObj","timeStamp","Date","getTime","act","time","game_mark","SystemInfo","cloudId","gameId","signStr","getConfigSignStr","paramStrList","key","finalUrl","shareManagerUrl","join","request","method","statusCode","ret","data","retmsg","index","_iconInfo","undefined","floor","freshAdIconByTime","_adNode","startFreshAdIcon","default_interval","_icon_interval","icon_interval","Timer","cancelTimer","director","setTimer","macro","REPEAT_FOREVER","sortedKeys","Object","keys","finalSign","hex_md5","prototype"],"mappings":"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","file":"AdManager.js","sourceRoot":"../../../../../assets/Script/CommonFrame","sourcesContent":["\n\n/**\n * 交叉导流相关系统接口, 调用导流接口使用showAd 接口， 刷新导流显示icon使用resetBtnIcon 接口\n */\ntywx.AdManager = {\n\n    retryTimes : 3, //3次网络重试的机会\n\n    AnimType : {\n        STATIC : 1, //静态\n        SHAKE  : 2, //抖动\n        FRAME  : 3  //帧动画\n\n    },\n\n    adNodeList :[],\n    allAdInfoList : [],\n\n    //创建导流icon，每调用一次就会创建一个\n    showAd: function(position) {\n\n        var _adnode = new tywx.AdManager.adNodeClass();\n        _adnode.adInfoList = JSON.parse(JSON.stringify(tywx.AdManager.allAdInfoList));\n\n        _adnode.createAdNode(position);\n\n        tywx.AdManager.adNodeList.push(_adnode);\n\n    },\n\n    //获取所有导流icon节点的列表\n    getAdNodeList : function () {\n        return this.adNodeList;\n    },\n\n    //获取当前所有导流信息\n    getAdInfoList : function () {\n        return this.allAdInfoList;\n    },\n\n    adNodeClass : function () {\n\n        this.adIconBtn = null;\n        this.currentAdInfo = null;\n        this.currentWebPage = null;\n        this.adInfoList = [];\n    },\n\n    adNodeObj  : {\n\n\n        createAdNode : function (pos) {\n\n            this.genRandomFirstAdInfo();\n            console.log(this.currentAdInfo+\"当前的广告ID = \"+JSON.stringify(pos)) \n            if(!this.currentAdInfo){\n                return;\n            }\n\n            if(this.adIconBtn) {\n                this.adIconBtn.active = true;\n            } else {\n                var that = this;\n                //动态加载资源必须放在resources目录下,导流入口强制命名为adNode,放在resources/prefabs下\n                cc.loader.loadRes('prefabs/adNode', function (err, prefab) {\n                    var preFabNode = cc.instantiate(prefab);\n                    preFabNode.position = cc.p(pos.x, pos.y);\n                    that.adIconBtn = preFabNode;\n                    cc.game.addPersistRootNode(preFabNode);\n                    that.adIconNode();\n                    var adButton = that.adIconBtn.getChildByName('adButton');\n                    adButton.on('click', function () {\n                        that.onClickAdIconBtn();\n                    });\n                });\n            }\n\n        },\n\n        genRandomFirstAdInfo : function() {\n\n            var that = this;\n\n            if(this.adInfoList.length == 0){\n                return;\n            }\n\n            var weight_list = [\n                {\n                    'weight':0,\n                    'id':'000'\n                }\n            ];\n\n            for(var i in this.adInfoList){\n\n                var _randomObj = {\n                    'weight' : parseInt(that.adInfoList[i].icon_weight),\n                    'id' : that.adInfoList[i].icon_id,\n                };\n                weight_list.push(_randomObj);\n            }\n\n            weight_list.sort(function(a, b){\n                return a.weight > b.weight;\n            });\n\n            var _total = 0;\n\n            weight_list.forEach(function (element){\n                _total += element.weight;\n            });\n\n            var _randomIndex = parseInt(Math.random()*10000)%(_total+1);\n\n            var _tTotal = 0;\n\n            var _selectIndex = 0;\n\n            for(var i=0; i<(weight_list.length-1);i++){\n                _tTotal += weight_list[i].weight;\n                if(_tTotal < _randomIndex && (_tTotal+weight_list[i+1].weight) >= _randomIndex){\n                    _selectIndex = i+1;\n                    break;\n                }\n            }\n            var _selectObj= weight_list[_selectIndex];\n\n            this.adInfoList.forEach(function (element){\n                if(element.icon_id == _selectObj.id){\n                    that.currentAdInfo = element;\n                }\n            });\n\n        },\n\n        genRandomSecondAdInfo : function() {\n\n            var that = this;\n\n            var _webPages = this.currentAdInfo.webpages;\n\n            if(_webPages.length == 0){\n                return;\n            }\n\n            var weight_list = [{'weight':0, 'id':'000'}];\n\n            for(var i in _webPages){\n\n                var _randomObj = {\n                    'weight' : parseInt(_webPages[i].webpage_weight),\n                    'id' : _webPages[i].config_id\n                }\n\n                weight_list.push(_randomObj);\n            }\n\n            weight_list.sort(function(a, b){\n                return a.weight > b.weight;\n            });\n\n            var _total = 0;\n\n            weight_list.forEach(function (element){\n                _total += element.weight;\n            });\n\n            var _randomIndex = parseInt(Math.random()*10000)%(_total+1);\n\n            var _tTotal = 0;\n\n            var _selectIndex = 0;\n            for(var i=0; i<(weight_list.length-1);i++){\n                _tTotal +=  weight_list[i].weight;\n                if(_tTotal < _randomIndex && (_tTotal+weight_list[i+1].weight) >= _randomIndex){\n                    _selectIndex = i+1;\n                    break;\n                }\n            }\n            var _selectObj = weight_list[_selectIndex];\n\n\n            _webPages.forEach(function(element){\n                if(element.config_id == _selectObj.id){\n                    that.currentWebPage = element;\n                }\n            });\n\n        },\n\n\n        adIconNode : function () {\n            if(!this.currentAdInfo || !this.adIconBtn){\n                return;\n            }\n\n            var _animaType = this.currentAdInfo.icon_type;\n            var that = this;\n\n            var spriteIco = this.adIconBtn.getChildByName('adIcon');\n            var adButton = this.adIconBtn.getChildByName('adButton');\n\n            spriteIco.stopAllActions();\n            spriteIco.removeComponent(cc.Animation);\n\n            spriteIco.setRotation(0);\n\n            tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeShowAdBtn, [that.currentAdInfo.icon_id,\n                                                                                        that.currentAdInfo.icon_type,\n                                                                                        that.currentAdInfo.icon_skip_type,\n                                                                                        that.currentAdInfo.toappid,\n                                                                                        that.currentAdInfo.togame]);\n            switch (_animaType){\n\n                case tywx.AdManager.AnimType.STATIC:\n\n                    cc.loader.load({url: that.currentAdInfo.icon_url[0]}, function (err, texture) {\n                        if (!err) {\n\n                            spriteIco.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n                            if(texture && texture.width && texture.height){\n                                spriteIco.setContentSize(cc.size(texture.width, texture.height));\n                            }\n                        }\n                        else {\n\n                        }\n                    });\n\n                    break;\n                case tywx.AdManager.AnimType.SHAKE:\n\n                    cc.loader.load({url:that.currentAdInfo.icon_url[0]}, function(error, texture){\n\n                        spriteIco.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n                        if(texture && texture.width && texture.height){\n                            spriteIco.setContentSize(cc.size(texture.width, texture.height));\n                        }\n                        spriteIco.anchorX = 0.5;\n                        spriteIco.anchorY = 0.5;\n                        var _act1 = cc.rotateBy(0.06, -20);\n                        var _act2 = cc.rotateBy(0.12, 40);\n                        var _act3 = cc.rotateBy(0.12, -40);\n                        var _act4 = cc.rotateBy(0.06, 20);\n                        var _delay = cc.delayTime(1);\n                        spriteIco.runAction(cc.repeatForever(cc.sequence(_act1,\n                            cc.repeat(cc.sequence(_act2, _act3), 4),\n                            _act4,\n                            _delay)));\n                    });\n\n\n                    break;\n                case tywx.AdManager.AnimType.FRAME:\n\n                    var allFrames =[];\n\n                    var playFrameAction = function () {\n                        spriteIco.stopAllActions();\n                        spriteIco.removeComponent(cc.Animation);\n                        var _firstFrameIcon = allFrames[0].getTexture();\n                        if (_firstFrameIcon && _firstFrameIcon.width && _firstFrameIcon.height) {\n                            spriteIco.setContentSize(cc.size(_firstFrameIcon.width, _firstFrameIcon.height));\n                        }\n\n                        var animation = spriteIco.addComponent(cc.Animation);\n                        var clip = cc.AnimationClip.createWithSpriteFrames(allFrames, 10);\n                        clip.name = 'anim_frame';\n                        clip.wrapMode = cc.WrapMode.Loop;\n                        animation.addClip(clip);\n                        animation.play('anim_frame');\n                    };\n\n                    cc.loader.load(that.currentAdInfo.icon_url,function (err, results) {\n\n                        if (err) {\n                            for (var i = 0; i < err.length; i++) {\n                                cc.log('Error url [' + err[i] + ']: ' + results.getError(err[i]));\n                            }\n                        }\n\n                        for(var i = 0; i < that.currentAdInfo.icon_url.length; i++) {\n                            if(results.getContent(that.currentAdInfo.icon_url[i])) {\n                                var _frame = new cc.SpriteFrame(results.getContent(that.currentAdInfo.icon_url[i]));\n                                allFrames.push(_frame);\n                            }\n                        }\n\n                        playFrameAction();\n                    });\n\n                    break;\n                default:\n                    break;\n\n            }\n\n        },\n\n        onClickAdIconBtn: function() {\n            try {\n                this.genRandomSecondAdInfo();\n\n                //先尝试直接跳转\n                var skip_type =  this.currentAdInfo.icon_skip_type;\n                var toappid = this.currentAdInfo.toappid;\n                var togame = this.currentAdInfo.togame;\n                var topath = this.currentAdInfo.path;\n                var second_toappid = this.currentAdInfo.second_toappid;\n\n                console.log('topath ====>' + topath);\n\n                var that = this;\n\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickAdBtn, [that.currentAdInfo.icon_id,\n                    that.currentAdInfo.toappid,\n                    that.currentAdInfo.togame]);\n\n                // //先尝试直接跳转\n                if(wx && wx.navigateToMiniProgram){\n                    if(1 == skip_type){\n\n                        wx.navigateToMiniProgram({\n                            appId: toappid,\n                            path : topath ? topath : '?from=adcross',\n                            envVersion: 'release',\n                            extraData: {\n                                from: topath ? topath : '?from=adcross',\n                            },\n                            success: function(res) {\n\n                                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameSuccess, [that.currentAdInfo.icon_id,\n                                    that.currentWebPage.config_id,\n                                    that.currentWebPage.webpage_url,\n                                    that.currentAdInfo.toappid,\n                                    that.currentAdInfo.togame]);\n\n                                console.log('wx.navigateToMiniProgram success');\n                                console.log(res);\n                            },\n                            fail: function (res) {\n                                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameFail, [that.currentAdInfo.icon_id,\n                                    that.currentWebPage.config_id,\n                                    that.currentWebPage.webpage_url,\n                                    that.currentAdInfo.toappid,\n                                    that.currentAdInfo.togame]);\n                                console.log('wx.navigateToMiniProgram fail');\n                                console.log(res);\n                            },\n                            complete: function (res) {\n                                console.log('navigateToMiniProgram ==== complete');\n                                that.resetBtnIcon();\n\n                            }\n                        });\n\n                        return;\n                    }else if(2 == skip_type){\n                        wx.navigateToMiniProgram({\n                            appId: second_toappid,\n                            path : topath ? topath : '?from=adcross',\n                            envVersion: 'release',\n                            extraData: {\n                                from: topath ? topath : '?from=adcross',\n                            },\n                            success: function(res) {\n                                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameSuccess, [that.currentAdInfo.icon_id,\n                                    that.currentWebPage.config_id,\n                                    that.currentWebPage.webpage_url,\n                                    that.currentAdInfo.toappid,\n                                    that.currentAdInfo.togame]);\n                                console.log('wx.navigateToMiniProgram success');\n                                console.log(res);\n                            },\n                            fail: function (res) {\n                                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickDirectToMiniGameFail, [that.currentAdInfo.icon_id,\n                                    that.currentWebPage.config_id,\n                                    that.currentWebPage.webpage_url,\n                                    that.currentAdInfo.toappid,\n                                    that.currentAdInfo.togame]);\n                                console.log('wx.navigateToMiniProgram fail');\n                                console.log(res);\n                            },\n                            complete: function (res) {\n                                that.resetBtnIcon();\n                                console.log('navigateToMiniProgram ==== complete');\n\n                            }\n                        });\n\n\n                    }else{\n                        console.error('Unsupported skip type! Please Check!');\n                    }\n\n                    return;\n                }\n\n                //直接跳转接口不好使，展示 小程序/小游戏 二维码图片\n                if(!this.currentWebPage){\n                    return;\n                }\n\n                console.log('当前要预览的图============》' + that.currentWebPage.webpage_url);\n\n                tywx.BiLog.clickStat(tywx.clickStatEventType.clickStatEventTypeClickShowQRCode, [that.currentAdInfo.icon_id,\n                    that.currentWebPage.config_id,\n                    that.currentWebPage.webpage_url,\n                    that.currentAdInfo.toappid,\n                    that.currentAdInfo.togame]);\n\n                if(tywx.IsWechatPlatform()) {\n                    wx.previewImage({\n                        current: [that.currentWebPage.webpage_url],\n                        urls: [that.currentWebPage.webpage_url],\n                        success:function(res){\n                            tywx.LOGD(null, \"预览图片成功！\");\n                        },\n                        fail:function (res) {\n                            tywx.LOGD(null, \"预览图片失败！\");\n                        },\n                        complete :function (res) {\n                            console.log('预览图片完成');\n                            that.resetBtnIcon();\n                        },\n                    });\n                }\n            } catch(err) {\n                tywx.LOGE(\"error:\", \"tywx.AdManager.onClickAdIconBtn——\" + JSON.stringify(err));\n            }\n        },\n\n        resetBtnIcon : function() {\n\n            if(!this.adIconBtn){\n                return;\n            }else{\n                this.genRandomFirstAdInfo();\n                this.adIconNode();\n            }\n\n        },\n\n        onForeGround : function () {\n            this.adIconNode();\n        },\n\n        showAdNode : function () {\n            if(this.adIconBtn){\n                if(this.adIconBtn) {\n                    this.adIconBtn.active = true;\n                }\n            }\n\n        },\n\n        hideAdNode : function () {\n\n            if(this.adIconBtn){\n                if(this.adIconBtn) {\n                    this.adIconBtn.active = false;\n                }\n            }\n\n        },\n\n    },\n\n    /**\n     * 请求交叉倒流的信息\n     */\n    requestADInfo : function () {\n        try {\n            if(!tywx.IsWechatPlatform()) {\n                return;\n            }\n            this.retryTimes--;\n            var reqObj = {};\n            var timeStamp = new Date().getTime();\n            reqObj.act = 'api.getCrossConfig';\n            reqObj.time = timeStamp;\n            reqObj.game_mark = tywx.SystemInfo.cloudId + \"-\" + tywx.SystemInfo.gameId;\n            var signStr = this.getConfigSignStr(reqObj);\n            var paramStrList = [];\n            for(var key in reqObj) {\n                paramStrList.push(key + '=' + reqObj[key]);\n            }\n            paramStrList.push('sign=' + signStr);\n            var finalUrl = tywx.SystemInfo.shareManagerUrl + '?' + paramStrList.join('&');\n            var that = this;\n            console.log(\"广告信息地址 = \"+finalUrl);\n            wx.request({\n                url : finalUrl,\n                method : 'GET',\n                success : function (res) {\n                    if (res.statusCode == 200){\n\n                        var ret = res.data;\n                        that.allAdInfoList = [];\n                        if(ret.retmsg){\n                            for(var index in ret.retmsg){\n\n                                var _iconInfo = ret.retmsg[index];\n\n                                if(_iconInfo.icon_weight == undefined){\n                                    _iconInfo.icon_weight = 0;\n                                }\n\n                                if(Math.floor(_iconInfo.icon_weight) > 0.1){  //处理配置成小数的情形  0.1以下直接默认不显示\n                                    that.allAdInfoList.push(_iconInfo);\n                                }\n                            }\n                        }\n\n                    }else{\n                        if(that.retryTimes >0) {\n                            that.requestADInfo();\n                        }else{\n                            that.retryTimes = 3;\n                        }\n                    }\n\n                },\n                fail : function (res) {\n\n                    if(that.retryTimes >0) {\n                        that.requestADInfo();\n                    }else{\n                        that.retryTimes = 3;\n                    }\n                }\n            });\n        } catch(err) {\n            tywx.LOGE(\"error:\", \"tywx.AdManager.requestADInfo——\" + JSON.stringify(err));\n        }\n    },\n\n    //定时刷新导流icon\n    freshAdIconByTime : function () {\n\n        if(0 == tywx.AdManager.adNodeList.length){\n            return;\n        }\n\n        for(var i=0; i<tywx.AdManager.adNodeList.length;i++){\n            var _adNode = tywx.AdManager.adNodeList[i];\n            _adNode && _adNode.resetBtnIcon && _adNode.resetBtnIcon();\n        }\n\n    },\n\n    //开始定时刷新导流icon\n    startFreshAdIcon :function () {\n\n        var default_interval = 10 ;//默认是10s刷新一次\n\n        for(var i=0; i< this.allAdInfoList.length;i++){\n\n            var _icon_interval = this.allAdInfoList[i].icon_interval;\n\n            if(_icon_interval){\n                default_interval = parseInt(_icon_interval) > 0?  parseInt(_icon_interval):default_interval;\n                break;\n            }\n\n        }\n\n        tywx.Timer.cancelTimer(cc.director, tywx.AdManager.freshAdIconByTime);\n        tywx.Timer.setTimer(cc.director, tywx.AdManager.freshAdIconByTime,default_interval, cc.macro.REPEAT_FOREVER,default_interval);\n\n    },\n\n    //从后台回到前台\n    onForeGround : function () {\n\n        for(var i=0; i<this.adNodeList.length;i++){\n            var _adNode = this.adNodeList[i];\n            _adNode && _adNode.onForeGround && _adNode.onForeGround();\n        }\n        this.startFreshAdIcon();\n    },\n\n    /**\n     * 计算签名字符串\n     * @param reqObj\n     * @returns {string}\n     */\n    getConfigSignStr: function(reqObj) {\n        var sortedKeys = Object.keys(reqObj).sort();\n        var signStr = '';\n        for(var i=0;i<sortedKeys.length;i++){\n            var key = sortedKeys[i];\n            if(key == 'act' || key == 'sign') {\n                continue;\n            } else {\n                signStr += key + '=' + reqObj[key];\n            }\n        }\n        var finalSign = tywx.hex_md5('market.tuyoo.com-api-' + signStr + '-market.tuyoo-api') || '';\n        return finalSign;\n    },\n\n};\n\ntywx.AdManager.adNodeClass.prototype = tywx.AdManager.adNodeObj;\ntywx.AdManager.requestADInfo();"]}